# 分布式锁

## 特点

1. 互斥性：任意时刻，只能有一个客户端获取锁，不能同时有两个客户端获取到锁
2. 安全性：锁只能被持有该锁的客户端删除，不能由其它客户端删除
3. 防死锁：获取锁的客户端因为某些原因（如down机等），需要设置一个策略把锁释放掉，否则其他客户端再也无法获取到该锁
4. 容错性：当部分服务节点down机时，客户端仍然能够获取锁和释放锁

## 基于数据库行级锁



## 基于Zookeeper的分布式锁



## 基于Redis的分布式锁

### Redis单节点加锁

> 基于Redis命令：SET key value NX EX max-lock-time





### Redisson加锁

有5台毫无任何关系的redis实例，参与分布式锁的竞争时，如果有一个线程过半通过，得到了3把锁，此时，其中有一台redis挂了，就剩下2把锁了，当这台挂的实例起来之后，由于数据的丢失，另外一个线程也能获得过半的实例个数，此时就会出现被多次加锁的情况：解决方案，让挂了的实例延迟启动，启动的时间要求大于锁的有效期时间


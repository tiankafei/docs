# 分布式锁

## 特点

1. 互斥性：任意时刻，只能有一个客户端获取锁，不能同时有两个客户端获取到锁
2. 安全性：锁只能被持有该锁的客户端删除，不能由其它客户端删除
3. 防死锁：获取锁的客户端因为某些原因（如down机等），需要设置一个策略把锁释放掉，否则其他客户端再也无法获取到该锁
4. 容错性：当部分服务节点down机时，客户端仍然能够获取锁和释放锁

## 基于数据库行级锁



## 基于Zookeeper的分布式锁



## 基于Redis的分布式锁

### Redis单节点加锁

基于Redis命令：SET key value NX EX max-lock-time，需要手动实现锁的延期

### Redisson加锁

redisson加锁的奇数个实例之间毫无任何关系，不需要进行数据同步，只要过半成功就说明加锁成功了。redisson会起一个线程，当执行时间到达锁过期时间的1/3时，如果依然没有执行完成，则进行锁的有效期延长；如果当前线程获取到锁之后，就宕机了，那么当过了锁的有效期之后，锁会被自动释放。

![分布式锁-redisson](\images\分布式锁-redisson.png)

